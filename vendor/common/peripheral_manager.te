# Policy for pm-service and pm-proxy
type vendor_per_mgr, domain;
type vendor_per_mgr_exec, exec_type, vendor_file_type, file_type;

init_daemon_domain(vendor_per_mgr);

add_service(vendor_per_mgr, vendor_per_mgr_service)

vndbinder_use(vendor_per_mgr)
binder_call(vendor_per_mgr, hal_gnss)
binder_call(vendor_per_mgr, vendor_per_proxy)
binder_call(vendor_per_mgr, wcnss_service)
binder_call(vendor_per_mgr, rild)

allow vendor_per_mgr self:capability net_bind_service;

allow vendor_per_mgr firmware_file:file r_file_perms;
allow vendor_per_mgr firmware_file:dir search;

allow vendor_per_mgr self:socket create_socket_perms;
allowxperm vendor_per_mgr self:socket ioctl msm_sock_ipc_ioctls;
allow vendor_per_mgr ssr_device:chr_file { open read };

# Needed by libmdmdetect to figure out the system configuration
r_dir_file(vendor_per_mgr, sysfs_esoc)

# Needed by libmdmdetect to get subsystem info and to check their states
r_dir_file(vendor_per_mgr, sysfs_ssr)
allow vendor_per_mgr sysfs_data:file r_file_perms;

# Set the peripheral state property
set_prop(vendor_per_mgr, vendor_per_mgr_state_prop);

allow vendor_per_mgr self:qipcrtr_socket create_socket_perms;
allowxperm vendor_per_mgr self:qipcrtr_socket ioctl msm_sock_ipc_ioctls;
